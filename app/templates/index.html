{% extends "base.html" %}

{% block content %}
  
{% if data %}

    {# {{ data }}   #}
  {% for stop in data %}

    <div class="col-md-6 col-sm-12 mb-3">
      <div class="card border-primary">
        <div class="card-header">
          <h4>Stop: {{ stop.name }}</h4>
          
        </div>
        <div class="card-body" id="{{ stop.code }}">
          <div id="s{{ stop.code }}" class="col text-center">
            <i class="fa fa-spinner fa-3x fa-spin m-x-auto"></i>
          </div>
{#           <table class="table table-hover">
            <thead>
              <tr>
                <th scope="col">Route</th>
                <th scope="col">From</th>
                <th scope="col">To</th>
                <th scope="col">Time</th>
              </tr>
            </thead>

            <tbody>

            {% for item in stop.data[:7] %}

              <tr>
                <td>{{ item['route_name'] }}</td>
                <td>{{ item['from'] }}</td>
                <td>{{ item['to'] }}</td>
                <td>{{ item['time_to_point'] | to_minutes }}</td>
              </tr>

            {% endfor %}

            </tbody>
          </table> #}
        </div>
      </div>
    </div>

  {% endfor %}


  {% else %}

  <h4>No stops added to dashboard.</h4>

{% endif %}

{% endblock content %}

{% block extra_js %}

  <script>

    $(document).ready(function(){
            var socket = io.connect('http://' + document.domain + ':' + location.port + '/dashboard');

              socket.on('connect', function() {
                  socket.emit('my_event', {msg: 'Client ACK'});
              });

            socket.on('connection_update', function(msg) {
              console.log(msg)
            });

            socket.on('update', function(msg) {
              var table = $('<table class="table table-hover"><tbody></tbody></table>')

              msg['info'].forEach(function(item){
                // console.log(item)
                var row = $('<tr><td>' + item.route_name + '</td><td>' + item.from + '</td><td>' + item.to + '</td><td>' + Math.floor(item.time_to_point / 60) + '</td></tr>');

                table.append(row)
              });

              $('div#s'+msg.stop).remove();

              $('#' + msg.stop).append(table);

            });
    });

  </script>

{% endblock extra_js %}
