{% extends "base.html" %}

{% block content %}

  <div class="col-md-8 offset-md-2 col">

    <div class="row">
      <div class="col-md-8 offset-md-2 col">
        <h2 class="text-center text-info">{{ route.name }}</h2>

        <div class="table">
          <table class="table table-hover">
            <tbody id="fbody">

            {% for _, stop in stops.items() %}

              <tr>
                <td>{{ stop.name }}</td>

                {% if current_user.is_authenticated %}
                  <td>
                    <form class="add_stop">
                      <input type="hidden" name="internal_id" value="{{ stop.internal_id }}">
                      <input type="hidden" name="name" value="{{ stop.name }}">
                      <input type="hidden" name="code" value="{{ stop.code }}">
                      <button type="submit" {% if stop.code in user_stops %} class="btn btn-outline-primary btn-info add-btn" disabled title="Stop is already added" {% else %}class="btn btn-info add-btn"{% endif %}>Add</button>
                    </form>
                  </td>
                {% endif %}

                <td><a href="{{ url_for('monitor_stop', stop_code=stop.code) }}" class="btn btn-info">Info</a></td>

                {# <td><button type="button" class="btn btn-info" disabled="">Show on map</button></td> #}
              </tr>

            {% endfor %}

            </tbody>

          </table>
        </div>
      </div>
    </div>

  </div>


  <script>

    function addStop(ev) {
      ev.preventDefault();

      $.ajax({
        method: 'POST',
        url: {{ url_for('add_stop')|tojson }},
        data: $(this).serialize()
      });

      $(this).children('button[type=submit]').prop('disabled', true).addClass('btn-outline-primary');

    };

    $('.add_stop').on('submit', addStop);

  </script>

{% endblock content %}
